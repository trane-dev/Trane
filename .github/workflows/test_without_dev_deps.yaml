name: Test without dev or test dependencies
on:
  pull_request:
    types:
      - opened
      - synchronize
      - ready_for_review
  push:
    branches:
      - main
  workflow_dispatch:
jobs:
  tests:
    name: 3.11 test
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python_version: ["latest", "minimal"]
    steps:
      - uses: actions/checkout@v3
      - name: Set up python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: 3.11
          cache: 'pip'
          cache-dependency-path: "pyproject.toml"
      - name: Build trane and install latest requirements
        if: ${{ matrix.python_version == 'latest' }}
        run: |
          make package
          python -m pip install unpacked_sdist/
      - name: Install minimal requirements
        if: ${{ matrix.python_version == 'minimal' }}
        run: |
          python -m pip install . --no-deps
          python -m pip install -r tests/minimal_requirements.txt
      - name: Run simple usage
        run: |
          import trane
          data, metadata = trane.load_airbnb()
          entity_columns = ["location"]
          window_size = "2d"
          problem_generator = trane.ProblemGenerator(
              metadata=metadata,
              window_size=window_size,
              entity_columns=entity_columns
          )
          problems = problem_generator.generate()
          print(f'Generated {len(problems)} problems')
          print(problems[96])
          print(problems[96].create_target_values(data).head(5))
        shell: python
